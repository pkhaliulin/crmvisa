<template>
    <LandingLayout @open-auth="showAuth = true">
        <!-- ================================================================
             HERO
        ================================================================ -->
        <section class="min-h-[90vh] flex items-center justify-center px-6 bg-gradient-to-b from-white to-slate-50">
            <div class="max-w-3xl mx-auto text-center">
                <div class="inline-flex items-center gap-2 px-3 py-1 rounded-full bg-[#1BA97F]/10
                            text-[#1BA97F] text-sm font-medium mb-8">
                    <span class="w-2 h-2 bg-[#1BA97F] rounded-full animate-pulse"></span>
                    –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —à–∞–Ω—Å—ã –±–µ—Å–ø–ª–∞—Ç–Ω–æ
                </div>

                <h1 class="text-5xl md:text-6xl font-bold text-[#0A1F44] leading-tight mb-6">
                    –ü–æ–ª—É—á–∏—Ç–µ –≤–∏–∑—É<br>
                    <span class="text-[#1BA97F]">–±—ã—Å—Ç—Ä–µ–µ –∏ —É–≤–µ—Ä–µ–Ω–Ω–µ–µ</span>
                </h1>

                <p class="text-xl text-gray-500 max-w-xl mx-auto mb-10 leading-relaxed">
                    –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —à–∞–Ω—Å–æ–≤ –Ω–∞ –æ–¥–æ–±—Ä–µ–Ω–∏–µ, OCR-—Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ –ø–∞—Å–ø–æ—Ä—Ç–∞
                    –∏ —Å–æ–ø—Ä–æ–≤–æ–∂–¥–µ–Ω–∏–µ –∞–≥–µ–Ω—Ç—Å—Ç–≤–∞ –≤ –æ–¥–Ω–æ–π –ø–ª–∞—Ç—Ñ–æ—Ä–º–µ.
                </p>

                <div class="flex flex-col sm:flex-row gap-3 justify-center">
                    <button @click="showAuth = true"
                        class="px-8 py-4 bg-[#0A1F44] text-white font-semibold rounded-xl
                               text-lg hover:bg-[#0d2a5e] transition-all shadow-lg shadow-[#0A1F44]/20">
                        –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —à–∞–Ω—Å—ã –Ω–∞ –≤–∏–∑—É
                    </button>
                    <a href="#countries"
                        class="px-8 py-4 bg-white text-[#0A1F44] font-semibold rounded-xl
                               text-lg border border-gray-200 hover:border-gray-300 transition-all">
                        –í—ã–±—Ä–∞—Ç—å —Å—Ç—Ä–∞–Ω—É
                    </a>
                </div>

                <!-- –°—Ç–∞—Ç—ã –¥–æ–≤–µ—Ä–∏—è -->
                <div class="mt-16 grid grid-cols-3 gap-8 max-w-lg mx-auto">
                    <div>
                        <div class="text-3xl font-bold text-[#0A1F44]">10+</div>
                        <div class="text-sm text-gray-400 mt-1">—Å—Ç—Ä–∞–Ω</div>
                    </div>
                    <div>
                        <div class="text-3xl font-bold text-[#0A1F44]">95%</div>
                        <div class="text-sm text-gray-400 mt-1">—Ç–æ—á–Ω–æ—Å—Ç—å —Å–∫–æ—Ä–∏–Ω–≥–∞</div>
                    </div>
                    <div>
                        <div class="text-3xl font-bold text-[#0A1F44]">3 –º–∏–Ω</div>
                        <div class="text-sm text-gray-400 mt-1">–¥–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞</div>
                    </div>
                </div>
            </div>
        </section>

        <!-- ================================================================
             –ö–ê–ö –≠–¢–û –†–ê–ë–û–¢–ê–ï–¢
        ================================================================ -->
        <section id="how" class="py-24 px-6">
            <div class="max-w-5xl mx-auto">
                <div class="text-center mb-16">
                    <h2 class="text-3xl font-bold text-[#0A1F44] mb-4">–ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç</h2>
                    <p class="text-gray-500 text-lg">–¢—Ä–∏ —à–∞–≥–∞ –æ—Ç —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –¥–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞</p>
                </div>

                <div class="grid md:grid-cols-3 gap-8">
                    <div v-for="step in steps" :key="step.num"
                        class="relative p-8 rounded-2xl bg-white border border-gray-100 shadow-sm hover:shadow-md transition-shadow">
                        <div class="w-12 h-12 rounded-xl flex items-center justify-center mb-6"
                             :class="step.bg">
                            <span class="text-2xl">{{ step.icon }}</span>
                        </div>
                        <div class="absolute top-6 right-6 text-4xl font-bold text-gray-100">
                            {{ step.num }}
                        </div>
                        <h3 class="font-bold text-[#0A1F44] text-lg mb-2">{{ step.title }}</h3>
                        <p class="text-gray-500 text-sm leading-relaxed">{{ step.desc }}</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- ================================================================
             –ü–û–ü–£–õ–Ø–†–ù–´–ï –ù–ê–ü–†–ê–í–õ–ï–ù–ò–Ø
        ================================================================ -->
        <section id="countries" class="py-24 px-6 bg-slate-50">
            <div class="max-w-5xl mx-auto">
                <div class="text-center mb-16">
                    <h2 class="text-3xl font-bold text-[#0A1F44] mb-4">–ü–æ–ø—É–ª—è—Ä–Ω—ã–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è</h2>
                    <p class="text-gray-500 text-lg">–°—Ç—Ä–∞–Ω—ã, –≥–¥–µ –¥–ª—è –≥—Ä–∞–∂–¥–∞–Ω –£–∑–±–µ–∫–∏—Å—Ç–∞–Ω–∞ —Ç—Ä–µ–±—É–µ—Ç—Å—è –≤–∏–∑–∞</p>
                </div>

                <div v-if="loading" class="grid grid-cols-2 md:grid-cols-5 gap-4">
                    <div v-for="i in 10" :key="i"
                        class="h-28 rounded-2xl bg-white animate-pulse border border-gray-100"></div>
                </div>

                <div v-else class="grid grid-cols-2 md:grid-cols-5 gap-4">
                    <button v-for="c in countries" :key="c.code"
                        @click="selectCountry(c)"
                        class="group p-5 bg-white rounded-2xl border border-gray-100 text-center
                               hover:border-[#1BA97F] hover:shadow-md transition-all duration-200
                               cursor-pointer"
                        :class="{ 'border-[#1BA97F] shadow-md': selectedCountry?.code === c.code }">
                        <div class="text-3xl mb-2">{{ c.flag }}</div>
                        <div class="font-semibold text-[#0A1F44] text-sm">{{ c.name }}</div>
                        <div class="text-xs text-[#1BA97F] mt-1 opacity-0 group-hover:opacity-100 transition-opacity">
                            –ü—Ä–æ–≤–µ—Ä–∏—Ç—å ‚Üí
                        </div>
                    </button>
                </div>

                <!-- CTA –ø–æ–¥ —Å—Ç—Ä–∞–Ω–∞–º–∏ -->
                <div v-if="selectedCountry" class="mt-8 p-6 bg-white rounded-2xl border border-[#1BA97F]/30
                                                    flex items-center justify-between gap-4 shadow-sm">
                    <div>
                        <div class="font-bold text-[#0A1F44] text-lg">
                            {{ selectedCountry.flag }} {{ selectedCountry.name }}
                        </div>
                        <div class="text-gray-500 text-sm mt-0.5">
                            –£–∑–Ω–∞–π—Ç–µ –≤–∞—à—É –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å –æ–¥–æ–±—Ä–µ–Ω–∏—è –∑–∞ 3 –º–∏–Ω—É—Ç—ã
                        </div>
                    </div>
                    <button @click="startScoring"
                        class="px-6 py-3 bg-[#1BA97F] text-white font-semibold rounded-xl
                               hover:bg-[#17956f] transition-colors whitespace-nowrap">
                        –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —à–∞–Ω—Å
                    </button>
                </div>
            </div>
        </section>

        <!-- ================================================================
             –°–ö–û–†–ò–ù–ì (–ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞)
        ================================================================ -->
        <section class="py-24 px-6">
            <div class="max-w-5xl mx-auto">
                <div class="grid md:grid-cols-2 gap-16 items-center">
                    <div>
                        <h2 class="text-3xl font-bold text-[#0A1F44] mb-6">
                            –£–º–Ω—ã–π —Å–∫–æ—Ä–∏–Ω–≥ ‚Äî –∑–Ω–∞–π—Ç–µ —à–∞–Ω—Å—ã –∑–∞—Ä–∞–Ω–µ–µ
                        </h2>
                        <p class="text-gray-500 leading-relaxed mb-8">
                            –ù–∞—à –∞–ª–≥–æ—Ä–∏—Ç–º –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç 7 —Ñ–∞–∫—Ç–æ—Ä–æ–≤: —Ñ–∏–Ω–∞–Ω—Å—ã, –∑–∞–Ω—è—Ç–æ—Å—Ç—å,
                            —Å–µ–º–µ–π–Ω—ã–π —Å—Ç–∞—Ç—É—Å, –∏–º—É—â–µ—Å—Ç–≤–æ, –∏—Å—Ç–æ—Ä–∏—é –ø–æ–µ–∑–¥–æ–∫ –∏ —Ü–µ–ª—å –≤–∏–∑–∏—Ç–∞.
                            –†–µ–∑—É–ª—å—Ç–∞—Ç ‚Äî –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–∞—è –æ—Ü–µ–Ω–∫–∞ 0‚Äì100 —Å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º–∏ —Å–æ–≤–µ—Ç–∞–º–∏.
                        </p>
                        <ul class="space-y-4">
                            <li v-for="f in features" :key="f"
                                class="flex items-start gap-3 text-gray-700">
                                <span class="text-[#1BA97F] font-bold text-lg leading-none mt-0.5">‚úì</span>
                                {{ f }}
                            </li>
                        </ul>
                        <button @click="showAuth = true"
                            class="mt-8 px-6 py-3 bg-[#0A1F44] text-white font-semibold rounded-xl
                                   hover:bg-[#0d2a5e] transition-colors">
                            –ù–∞—á–∞—Ç—å –±–µ—Å–ø–ª–∞—Ç–Ω–æ
                        </button>
                    </div>

                    <!-- –ú–æ–∫-–∫–∞—Ä—Ç–æ—á–∫–∞ —Å–∫–æ—Ä–∏–Ω–≥–∞ -->
                    <div class="bg-white rounded-3xl border border-gray-100 shadow-xl p-8">
                        <div class="text-center mb-6">
                            <div class="text-sm text-gray-400 mb-2">–í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å –æ–¥–æ–±—Ä–µ–Ω–∏—è</div>
                            <div class="relative inline-flex items-center justify-center">
                                <svg class="w-40 h-40 -rotate-90" viewBox="0 0 120 120">
                                    <circle cx="60" cy="60" r="50" fill="none" stroke="#f1f5f9" stroke-width="10"/>
                                    <circle cx="60" cy="60" r="50" fill="none" stroke="#1BA97F" stroke-width="10"
                                            stroke-linecap="round"
                                            :stroke-dasharray="`${mockScore * 3.14} 314`"
                                            class="transition-all duration-1000"/>
                                </svg>
                                <div class="absolute inset-0 flex items-center justify-center">
                                    <div>
                                        <div class="text-4xl font-bold text-[#0A1F44]">{{ mockScore }}%</div>
                                        <div class="text-xs text-[#1BA97F] font-medium text-center">–í—ã—Å–æ–∫–∏–π</div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="space-y-3 mb-6">
                            <div v-for="b in mockBreakdown" :key="b.label" class="flex items-center gap-3">
                                <span class="text-xs text-gray-400 w-24 shrink-0">{{ b.label }}</span>
                                <div class="flex-1 bg-gray-100 rounded-full h-2">
                                    <div class="h-2 rounded-full bg-[#1BA97F] transition-all duration-700"
                                         :style="{ width: b.val + '%' }"></div>
                                </div>
                                <span class="text-xs font-medium text-gray-600 w-8 text-right">{{ b.val }}</span>
                            </div>
                        </div>

                        <div class="p-3 bg-amber-50 rounded-xl text-xs text-amber-700">
                            –î–æ–±–∞–≤—å—Ç–µ —Å–ø—Ä–∞–≤–∫—É –æ –¥–æ—Ö–æ–¥–∞—Ö, —á—Ç–æ–±—ã –ø–æ–≤—ã—Å–∏—Ç—å —Å–∫–æ—Ä–∏–Ω–≥ –¥–æ 85%
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- ================================================================
             –ê–ì–ï–ù–¢–°–¢–í–ê
        ================================================================ -->
        <section id="agencies" class="py-24 px-6 bg-[#0A1F44]">
            <div class="max-w-5xl mx-auto text-center">
                <h2 class="text-3xl font-bold text-white mb-4">–†–∞–±–æ—Ç–∞–µ–º —Å –ø—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã–º–∏ –∞–≥–µ–Ω—Ç—Å—Ç–≤–∞–º–∏</h2>
                <p class="text-white/60 text-lg mb-12">
                    –ü–æ—Å–ª–µ —Å–∫–æ—Ä–∏–Ω–≥–∞ –≤–∞—Å —Å–æ–µ–¥–∏–Ω—è—Ç —Å –∞–≥–µ–Ω—Ç—Å—Ç–≤–æ–º, –∫–æ—Ç–æ—Ä–æ–µ —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è –Ω–∞ –≤–∞—à–µ–π —Å—Ç—Ä–∞–Ω–µ
                </p>
                <div class="grid md:grid-cols-3 gap-6 mb-10">
                    <div v-for="b in agencyBenefits" :key="b.title"
                        class="p-6 bg-white/5 rounded-2xl border border-white/10 text-left">
                        <div class="text-2xl mb-3">{{ b.icon }}</div>
                        <div class="font-bold text-white mb-1">{{ b.title }}</div>
                        <div class="text-white/50 text-sm">{{ b.desc }}</div>
                    </div>
                </div>
                <button @click="showAuth = true"
                    class="px-8 py-4 bg-[#1BA97F] text-white font-semibold rounded-xl text-lg
                           hover:bg-[#17956f] transition-colors">
                    –ù–∞–π—Ç–∏ –∞–≥–µ–Ω—Ç—Å—Ç–≤–æ
                </button>
            </div>
        </section>

        <!-- ================================================================
             –ú–û–î–ê–õ –ê–í–¢–û–†–ò–ó–ê–¶–ò–ò
        ================================================================ -->
        <PhoneAuthModal
            v-if="showAuth"
            :preselected-country="selectedCountry?.code"
            @close="showAuth = false"
            @success="onAuthSuccess"
        />
    </LandingLayout>
</template>

<script setup>
import { ref, onMounted } from 'vue';
import { useRouter } from 'vue-router';
import LandingLayout from '@/layouts/LandingLayout.vue';
import PhoneAuthModal from '@/pages/public/PhoneAuthModal.vue';
import { publicPortalApi } from '@/api/public';
import { usePublicAuthStore } from '@/stores/publicAuth';

const router      = useRouter();
const publicAuth  = usePublicAuthStore();
const showAuth    = ref(false);
const loading     = ref(true);
const countries   = ref([]);
const selectedCountry = ref(null);
const mockScore   = ref(0);

onMounted(async () => {
    try {
        const { data } = await publicPortalApi.countries();
        countries.value = data.data;
    } finally {
        loading.value = false;
    }
    // –ê–Ω–∏–º–∞—Ü–∏—è —Å–∫–æ—Ä–∞ –≤ –¥–µ–º–æ-–∫–∞—Ä—Ç–æ—á–∫–µ
    setTimeout(() => { mockScore.value = 72; }, 500);
});

const steps = [
    { num: '01', icon: 'üì±', bg: 'bg-blue-50',  title: '–í–æ–π–¥–∏—Ç–µ —á–µ—Ä–µ–∑ —Ç–µ–ª–µ—Ñ–æ–Ω',      desc: '–û–¥–Ω–æ SMS ‚Äî –∏ –≤—ã –≤ —Å–∏—Å—Ç–µ–º–µ. –ë–µ–∑ –ø–∞—Ä–æ–ª–µ–π. –ù–∏–∫–∞–∫–æ–π –ª–∏—à–Ω–µ–π —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏.' },
    { num: '02', icon: 'üõÇ', bg: 'bg-green-50', title: '–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –ø—Ä–æ—Ñ–∏–ª—å –∏–ª–∏ –∑–∞–≥—Ä—É–∑–∏—Ç–µ –ø–∞—Å–ø–æ—Ä—Ç', desc: 'OCR –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å—á–∏—Ç–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –ø–∞—Å–ø–æ—Ä—Ç–∞. –ò–ª–∏ –≤–≤–µ–¥–∏—Ç–µ –≤—Ä—É—á–Ω—É—é –∑–∞ 2 –º–∏–Ω—É—Ç—ã.' },
    { num: '03', icon: 'üéØ', bg: 'bg-purple-50', title: '–ü–æ–ª—É—á–∏—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç',         desc: '–°–∫–æ—Ä–∏–Ω–≥ 0‚Äì100 —Å —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è–º–∏. –í—ã–±–µ—Ä–∏—Ç–µ –∞–≥–µ–Ω—Ç—Å—Ç–≤–æ –∏ –Ω–∞—á–Ω–∏—Ç–µ –ø–æ–¥–∞—á—É.' },
];

const features = [
    '–ë–µ—Å–ø–ª–∞—Ç–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–ª—è 10+ —Å—Ç—Ä–∞–Ω',
    '–ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —É–ª—É—á—à–µ–Ω–∏—é –ø—Ä–æ—Ñ–∏–ª—è',
    'OCR-—Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ –ø–∞—Å–ø–æ—Ä—Ç–∞ ‚Äî –¥–∞–Ω–Ω—ã–µ –∑–∞–ø–æ–ª–Ω—è—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏',
    '–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –∞–≥–µ–Ω—Ç—Å—Ç–≤—É –ø–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º —Å–∫–æ—Ä–∏–Ω–≥–∞',
];

const mockBreakdown = [
    { label: '–§–∏–Ω–∞–Ω—Å—ã',     val: 78 },
    { label: '–ü—Ä–∏–≤—è–∑–∞–Ω–Ω–æ—Å—Ç—å', val: 85 },
    { label: '–ò—Å—Ç–æ—Ä–∏—è',     val: 55 },
    { label: '–ü—Ä–æ—Ñ–∏–ª—å',     val: 90 },
];

const agencyBenefits = [
    { icon: '‚≠ê', title: '–†–µ–π—Ç–∏–Ω–≥ –∏ –æ—Ç–∑—ã–≤—ã',   desc: '–¢–æ–ª—å–∫–æ –≤–µ—Ä–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∞–≥–µ–Ω—Ç—Å—Ç–≤–∞ —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ –æ—Ç–∑—ã–≤–∞–º–∏' },
    { icon: 'üìç', title: '–¢—Ä–µ–∫–∏–Ω–≥ –∑–∞—è–≤–∫–∏',     desc: '–°—Ç–∞—Ç—É—Å –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏ ‚Äî –≥–¥–µ –≤–∞—à–∏ –¥–æ–∫—É–º–µ–Ω—Ç—ã –ø—Ä—è–º–æ —Å–µ–π—á–∞—Å' },
    { icon: 'üí¨', title: '–ü—Ä—è–º–∞—è —Å–≤—è–∑—å',       desc: '–ß–∞—Ç —Å –º–µ–Ω–µ–¥–∂–µ—Ä–æ–º –±–µ–∑ –ø–æ—Å—Ä–µ–¥–Ω–∏–∫–æ–≤ –∏ —Å–∫—Ä—ã—Ç—ã—Ö –∫–æ–º–∏—Å—Å–∏–π' },
];

function selectCountry(c) {
    selectedCountry.value = c;
}

function startScoring() {
    if (publicAuth.isLoggedIn) {
        router.push({ name: 'public.scoring', query: { country: selectedCountry.value?.code } });
    } else {
        showAuth.value = true;
    }
}

function onAuthSuccess() {
    showAuth.value = false;
    router.push({ name: 'public.scoring', query: { country: selectedCountry.value?.code } });
}
</script>
